# rs_guard æµ‹è¯•æŒ‡å—

## æ¦‚è¿°

rs_guard é¡¹ç›®ä½¿ç”¨å¤šå±‚æ¬¡çš„æµ‹è¯•ç­–ç•¥æ¥ç¡®ä¿ä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚æœ¬æŒ‡å—è¯´æ˜äº†å¦‚ä½•è¿è¡Œå’Œç†è§£å„ç§æµ‹è¯•ã€‚

## æµ‹è¯•å±‚æ¬¡

### 1. å•å…ƒæµ‹è¯•
- **ä½ç½®**: `backend/src/` å„ä¸ªæ¨¡å—ä¸­çš„ `#[cfg(test)]` å—
- **ç›®çš„**: æµ‹è¯•å•ä¸ªå‡½æ•°å’Œæ¨¡å—çš„åŠŸèƒ½
- **è¿è¡Œ**: `cargo test --lib`

### 2. é›†æˆæµ‹è¯•
- **ä½ç½®**: `backend/tests/` ç›®å½•
- **ç›®çš„**: æµ‹è¯•å¤šä¸ªæ¨¡å—ä¹‹é—´çš„äº¤äº’
- **è¿è¡Œ**: `cargo test integration_simple`

### 3. API æµ‹è¯•
- **ä½ç½®**: `backend/tests/api_tests.rs`
- **ç›®çš„**: æµ‹è¯• HTTP API ç«¯ç‚¹
- **è¿è¡Œ**: `cargo test api_tests`

### 4. BDD æµ‹è¯•
- **ä½ç½®**: `tests/bdd_simple.sh`
- **ç›®çš„**: æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œï¼ŒéªŒè¯ç«¯åˆ°ç«¯åŠŸèƒ½
- **è¿è¡Œ**: `./tests/bdd_simple.sh`

### 5. ç”¨æˆ·éªŒæ”¶æµ‹è¯• (UAT)
- **ä½ç½®**: `tests/integration_simple.rs`
- **ç›®çš„**: éªŒè¯ç³»ç»Ÿæ˜¯å¦æ»¡è¶³ç”¨æˆ·éœ€æ±‚
- **è¿è¡Œ**: `cargo test integration_suite`

## å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# ä½¿ç”¨æä¾›çš„è„šæœ¬è¿è¡Œæ‰€æœ‰æµ‹è¯•
./run_tests.sh
```

### 2. è¿è¡Œç‰¹å®šç±»å‹çš„æµ‹è¯•

```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
cargo test --lib

# åªè¿è¡Œé›†æˆæµ‹è¯•
cargo test integration_simple

# åªè¿è¡Œ API æµ‹è¯•
cargo test api_tests

# åªè¿è¡Œ BDD æµ‹è¯•
./tests/bdd_simple.sh
```

### 3. è¿è¡Œå•ä¸ªæµ‹è¯•

```bash
# è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°
cargo test test_service_status

# è¿è¡Œç‰¹å®šæ¨¡å—çš„æµ‹è¯•
cargo test backend::tests::status_endpoint_returns_ok_and_correct_payload
```

## æµ‹è¯•ç¯å¢ƒè¦æ±‚

### å¿…éœ€çš„å·¥å…·
- **Rust**: 1.70+
- **Cargo**: åŒ…å«åœ¨ Rust ä¸­
- **curl**: ç”¨äº HTTP æµ‹è¯•

### å¯é€‰çš„å·¥å…·
- **jq**: ç”¨äº JSON å¤„ç†
- **cargo-nextest**: å¹¶è¡Œæµ‹è¯•è¿è¡Œå™¨
- **cargo-tarpaulin**: ä»£ç è¦†ç›–ç‡å·¥å…·

### æµ‹è¯•æ•°æ®
æµ‹è¯•ä¼šè‡ªåŠ¨åˆ›å»ºå’Œæ¸…ç†æµ‹è¯•æ•°æ®ï¼š
- `test-data/source/`: æµ‹è¯•æºæ–‡ä»¶
- `test-data/output/`: æµ‹è¯•è¾“å‡ºæ–‡ä»¶

## æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½

### æ–‡ä»¶ä¿æŠ¤åŠŸèƒ½
- âœ… æ–‡ä»¶ç›‘æ§å’Œæ£€æµ‹
- âœ… Reed-Solomon ç¼–ç 
- âœ… æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
- âœ… è‡ªåŠ¨æ•°æ®ä¿®å¤

### Web ç•Œé¢åŠŸèƒ½
- âœ… æœåŠ¡çŠ¶æ€æŸ¥è¯¢
- âœ… é…ç½®ç®¡ç†
- âœ… æ—¥å¿—æŸ¥çœ‹
- âœ… å®æ—¶çŠ¶æ€æ›´æ–°

### API åŠŸèƒ½
- âœ… RESTful API ç«¯ç‚¹
- âœ… JSON å“åº”æ ¼å¼
- âœ… é”™è¯¯å¤„ç†
- âœ… çŠ¶æ€æŸ¥è¯¢

### æ€§èƒ½å’Œå¯é æ€§
- âœ… å¹¶å‘æ“ä½œ
- âœ… é”™è¯¯æ¢å¤
- âœ… èµ„æºç®¡ç†
- âœ… å†…å­˜ä½¿ç”¨

## æµ‹è¯•ç»“æœè§£è¯»

### æˆåŠŸçš„æµ‹è¯•
```
âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥é€šè¿‡
âœ… Web ç•Œé¢è®¿é—®æ­£å¸¸
âœ… æ–‡ä»¶æ“ä½œæµ‹è¯•é€šè¿‡
âœ… é…ç½®éªŒè¯é€šè¿‡
âœ… å¥åº·æ£€æŸ¥é€šè¿‡
```

### å¤±è´¥çš„æµ‹è¯•
```
âŒ æœåŠ¡çŠ¶æ€æ£€æŸ¥å¤±è´¥
âŒ Web ç•Œé¢è®¿é—®å¤±è´¥
âŒ æµ‹è¯•æ–‡ä»¶åˆ›å»ºå¤±è´¥
âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
âŒ å¥åº·æ£€æŸ¥å¤±è´¥
```

### å¸¸è§é—®é¢˜

1. **æœåŠ¡æœªå¯åŠ¨**
   - ç¡®ä¿ `./target/release/backend` æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥ç«¯å£ 3000 æ˜¯å¦è¢«å ç”¨

2. **æƒé™é—®é¢˜**
   - ç¡®ä¿æœ‰å†™å…¥æµ‹è¯•ç›®å½•çš„æƒé™
   - æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæƒé™

3. **ä¾èµ–é—®é¢˜**
   - è¿è¡Œ `cargo build` ç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½å·²å®‰è£…
   - æ£€æŸ¥ Rust ç‰ˆæœ¬å…¼å®¹æ€§

## æŒç»­é›†æˆ

### GitHub Actions
é¡¹ç›®åŒ…å« GitHub Actions å·¥ä½œæµï¼Œä¼šè‡ªåŠ¨è¿è¡Œï¼š
- ä»£ç æ ¼å¼æ£€æŸ¥
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- æ„å»ºéªŒè¯

### æœ¬åœ°æµ‹è¯•
åœ¨æäº¤ä»£ç å‰ï¼Œå»ºè®®è¿è¡Œï¼š
```bash
# æ ¼å¼æ£€æŸ¥
cargo fmt --check

# é™æ€åˆ†æ
cargo clippy -- -D warnings

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./run_tests.sh
```

## ç¼–å†™æ–°æµ‹è¯•

### æ·»åŠ å•å…ƒæµ‹è¯•
```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_my_function() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        let input = "test";
        
        // æ‰§è¡Œæµ‹è¯•
        let result = my_function(input);
        
        // éªŒè¯ç»“æœ
        assert_eq!(result, "expected");
    }
}
```

### æ·»åŠ é›†æˆæµ‹è¯•
```rust
use reqwest::Client;

#[tokio::test]
async fn test_api_endpoint() {
    let client = Client::new();
    let response = client
        .get("http://localhost:3000/api/status")
        .send()
        .await
        .unwrap();
    
    assert!(response.status().is_success());
}
```

### æ·»åŠ  BDD æµ‹è¯•
```bash
# åœ¨ bdd_simple.sh ä¸­æ·»åŠ 
echo "ğŸ§ª æµ‹è¯• 6: æ–°åŠŸèƒ½æµ‹è¯•"
echo "---------------------------------"
# æ·»åŠ æµ‹è¯•é€»è¾‘
```

## æµ‹è¯•æŠ¥å‘Š

### è‡ªåŠ¨ç”Ÿæˆçš„æŠ¥å‘Š
- `test_report.md`: æµ‹è¯•ç»“æœæ€»ç»“
- `backend/coverage/`: ä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼ˆå¦‚æœå®‰è£…äº† tarpaulinï¼‰

### è‡ªå®šä¹‰æŠ¥å‘Š
å¯ä»¥é€šè¿‡ä¿®æ”¹ `run_tests.sh` è„šæœ¬æ¥ç”Ÿæˆè‡ªå®šä¹‰æ ¼å¼çš„æµ‹è¯•æŠ¥å‘Šã€‚

## æ•…éšœæ’é™¤

### æµ‹è¯•å¤±è´¥æ—¶çš„è°ƒè¯•æ­¥éª¤
1. æŸ¥çœ‹è¯¦ç»†çš„æµ‹è¯•è¾“å‡ºï¼š`cargo test -- --nocapture`
2. æ£€æŸ¥æµ‹è¯•ç¯å¢ƒï¼šç¡®ä¿æ²¡æœ‰å†²çªçš„è¿›ç¨‹
3. æ¸…ç†å¹¶é‡æ–°æ„å»ºï¼š`cargo clean && cargo build`
4. æŸ¥çœ‹æ—¥å¿—ï¼š`RUST_LOG=debug cargo test`

### æ€§èƒ½é—®é¢˜
- ä½¿ç”¨ `cargo test --release` è¿è¡Œä¼˜åŒ–ç‰ˆæœ¬
- è€ƒè™‘å‡å°‘å¹¶è¡Œæµ‹è¯•çº¿ç¨‹æ•°
- å¢åŠ æµ‹è¯•è¶…æ—¶æ—¶é—´

## è´¡çŒ®æŒ‡å—

1. æ–°åŠŸèƒ½å¿…é¡»åŒ…å«ç›¸åº”çš„æµ‹è¯•
2. æµ‹è¯•è¦†ç›–ç‡ä¸åº”ä½äºå½“å‰æ°´å¹³
3. æ‰€æœ‰æµ‹è¯•å¿…é¡»åœ¨ CI ç¯å¢ƒä¸­é€šè¿‡
4. éµå¾ªç°æœ‰çš„æµ‹è¯•å‘½åå’Œç»“æ„çº¦å®š

## å‚è€ƒèµ„æ–™

- [Rust æµ‹è¯•æ–‡æ¡£](https://doc.rust-lang.org/book/ch11-00-testing.html)
- [Cargo æµ‹è¯•æŒ‡å—](https://doc.rust-lang.org/cargo/guide/tests.html)
- [BDD æœ€ä½³å®è·µ](https://cucumber.io/docs/bdd/)
- [API æµ‹è¯•æœ€ä½³å®è·µ](https://martinfowler.com/articles/practical-test-pyramid.html)