# rs_guard 用户验收测试需求

## 项目概述

rs_guard 是一个基于 Rust 的数据保护服务，提供块级冗余备份与完整性校验。系统采用 Reed-Solomon 编码技术，通过监控指定目录的文件变化，自动生成冗余分片并定期进行完整性检查和修复。

## 测试环境要求

### 硬件环境
- **CPU**: 2核心以上
- **内存**: 4GB以上
- **磁盘空间**: 至少 10GB 可用空间
- **操作系统**: Linux/macOS/Windows

### 软件环境
- **Rust**: 1.70+
- **Node.js**: 16+ (用于前端开发)
- **浏览器**: Chrome/Firefox/Safari 最新版本
- **测试工具**: 
  - cargo test
  - curl/httpie (API 测试)
  - Postman (可选)

### 测试数据准备
```bash
# 创建测试目录结构
mkdir -p ./test-data/source
mkdir -p ./test-data/backup
mkdir -p ./test-data/temp

# 创建测试文件
echo "测试文件内容" > ./test-data/source/test1.txt
echo "另一个测试文件" > ./test-data/source/test2.txt
dd if=/dev/urandom of=./test-data/source/large_file.bin bs=1M count=10
```

## 功能测试需求

### 1. 系统启动和配置管理

#### FR-001: 系统启动
**描述**: 系统能够正常启动并加载配置
**优先级**: 高
**验收标准**:
- [ ] 后端服务能够在 3000 端口启动
- [ ] 前端界面能够正常加载
- [ ] 配置文件能够正确解析
- [ ] 元数据数据库能够正常初始化

#### FR-002: 配置管理
**描述**: 系统能够读取和应用配置参数
**优先级**: 高
**验收标准**:
- [ ] 支持多个监控目录配置
- [ ] 支持自定义 Reed-Solomon 参数（data_shards, parity_shards）
- [ ] 配置变更后需要重启服务生效
- [ ] 错误配置能够提供清晰的错误信息

### 2. 文件监控和编码

#### FR-003: 文件系统监控
**描述**: 系统能够实时监控指定目录的文件变化
**优先级**: 高
**验收标准**:
- [ ] 能够检测新文件的创建
- [ ] 能够检测文件的修改
- [ ] 能够检测文件的删除
- [ ] 支持递归监控子目录
- [ ] 监控事件延迟不超过 2 秒

#### FR-004: Reed-Solomon 编码
**描述**: 系统能够对监控的文件进行 Reed-Solomon 编码
**优先级**: 高
**验收标准**:
- [ ] 能够正确生成数据分片和校验分片
- [ ] 分片文件存储在指定位置
- [ ] 编码过程不影响原文件
- [ ] 支持大文件分块编码（>100MB）
- [ ] 编码速度至少达到 10MB/s

#### FR-005: 元数据管理
**描述**: 系统能够正确管理文件和分片的元数据
**优先级**: 高
**验收标准**:
- [ ] 能够存储文件路径、大小、修改时间等信息
- [ ] 能够记录分片位置和校验信息
- [ ] 支持元数据的查询和更新
- [ ] 元数据丢失后能够重建

### 3. 完整性检查

#### FR-006: 手动完整性检查
**描述**: 用户能够手动触发完整性检查
**优先级**: 高
**验收标准**:
- [ ] 能够通过 Web 界面触发检查
- [ ] 能够通过 API 触发检查
- [ ] 检查过程不影响系统正常运行
- [ ] 检查结果准确显示

#### FR-007: 定时完整性检查
**描述**: 系统能够按预定时间自动进行完整性检查
**优先级**: 高
**验收标准**:
- [ ] 支持配置检查间隔（默认 1 小时）
- [ ] 定时任务能够正常启动和执行
- [ ] 检查结果能够正确记录
- [ ] 定时任务异常能够自动恢复

#### FR-008: 损坏检测
**描述**: 系统能够准确检测文件和分片的损坏
**优先级**: 高
**验收标准**:
- [ ] 能够检测分片文件的缺失
- [ ] 能够检测分片文件的损坏（通过校验和）
- [ ] 能够检测原文件的损坏
- [ ] 误报率低于 1%
- [ ] 漏报率低于 1%

### 4. 数据修复

#### FR-009: 自动修复
**描述**: 系统能够自动修复损坏的数据
**优先级**: 高
**验收标准**:
- [ ] 能够使用剩余的分片重建损坏的分片
- [ ] 能够修复原文件（如果配置了备份）
- [ ] 修复后的数据完整性验证通过
- [ ] 支持最多 N 个分片同时损坏的修复（N = parity_shards）

#### FR-010: 手动修复
**描述**: 用户能够手动触发修复操作
**优先级**: 中
**验收标准**:
- [ ] 能够通过 Web 界面触发修复
- [ ] 能够通过 API 触发修复
- [ ] 支持选择性修复特定文件
- [ ] 修复进度能够实时显示

### 5. Web 管理界面

#### FR-011: 仪表板
**描述**: 提供系统状态概览
**优先级**: 高
**验收标准**:
- [ ] 显示系统运行状态
- [ ] 显示监控目录列表
- [ ] 显示受保护文件数量
- [ ] 显示最近检查时间和结果
- [ ] 显示系统日志

#### FR-012: 文件管理
**描述**: 提供文件级别的管理功能
**优先级**: 中
**验收标准**:
- [ ] 显示受保护文件列表
- [ ] 支持文件搜索和过滤
- [ ] 显示文件详细信息和分片状态
- [ ] 支持手动触发特定文件的检查和修复

#### FR-013: 配置管理界面
**描述**: 提供配置管理的 Web 界面
**优先级**: 中
**验收标准**:
- [ ] 显示当前配置参数
- [ ] 支持修改监控目录
- [ ] 支持调整 Reed-Solomon 参数
- [ ] 配置变更需要确认才能生效

### 6. 性能和负载测试

#### FR-014: 小规模性能测试
**描述**: 测试系统在小规模数据下的性能
**优先级**: 高
**验收标准**:
- [ ] 100 个小文件（<1MB）的编码时间 < 30 秒
- [ ] 完整性检查时间 < 10 秒
- [ ] Web 界面响应时间 < 2 秒
- [ ] 内存使用 < 100MB

#### FR-015: 中规模性能测试
**描述**: 测试系统在中规模数据下的性能
**优先级**: 高
**验收标准**:
- [ ] 1000 个文件的总大小 1GB 的编码时间 < 5 分钟
- [ ] 完整性检查时间 < 2 分钟
- [ ] 系统稳定运行 24 小时无内存泄漏
- [ ] CPU 使用率 < 50%

#### FR-016: 大规模性能测试
**描述**: 测试系统在大规模数据下的性能
**优先级**: 中
**验收标准**:
- [ ] 10000 个文件的总大小 10GB 的编码时间 < 30 分钟
- [ ] 完整性检查时间 < 10 分钟
- [ ] 支持并发处理多个文件
- [ ] 磁盘 I/O 优化，避免性能瓶颈

### 7. 错误处理和恢复

#### FR-017: 磁盘空间不足
**描述**: 系统能够处理磁盘空间不足的情况
**优先级**: 高
**验收标准**:
- [ ] 检测到磁盘空间不足时停止编码
- [ ] 提供清晰的错误提示
- [ ] 空间恢复后能够继续工作
- [ ] 不影响已有数据的完整性

#### FR-018: 权限错误处理
**描述**: 系统能够处理文件权限问题
**优先级**: 高
**验收标准**:
- [ ] 无法访问文件时记录错误日志
- [ ] 跳过无权限文件并继续处理其他文件
- [ ] 提供权限问题的解决方案建议
- [ ] 不影响系统整体运行

#### FR-019: 网络和存储故障
**描述**: 系统能够处理存储设备故障
**优先级**: 中
**验收标准**:
- [ ] 存储设备离线时能够检测到
- [ ] 设备恢复后能够重新同步
- [ ] 支持多个存储设备的故障切换
- [ ] 提供故障恢复的详细日志

### 8. 安全性测试

#### FR-020: 访问控制
**描述**: 系统具有基本的访问控制
**优先级**: 中
**验收标准**:
- [ ] Web 界面需要身份验证
- [ ] API 接口需要授权
- [ ] 支持用户角色管理
- [ ] 敏感操作需要二次确认

#### FR-021: 数据安全
**描述**: 确保存储数据的安全性
**优先级**: 中
**验收标准**:
- [ ] 分片文件存储在安全位置
- [ ] 支持数据加密（可选）
- [ ] 原文件删除后分片也被删除
- [ ] 审计日志记录所有操作

## 非功能性需求

### NFR-001: 性能
**描述**: 系统响应时间和处理能力要求
**指标**:
- Web 界面响应时间 < 2 秒
- API 响应时间 < 200ms
- 文件编码吞吐量 > 10MB/s
- 完整性检查速度 > 100MB/s

### NFR-002: 可靠性
**描述**: 系统稳定性和故障恢复能力
**指标**:
- 系统可用性 > 99.5%
- 故障恢复时间 < 5 分钟
- 数据恢复成功率 > 99%
- 支持 7x24 小时运行

### NFR-003: 可扩展性
**描述**: 系统处理能力扩展性
**指标**:
- 支持监控目录数量 > 100 个
- 支持受保护文件数量 > 100,000 个
- 支持总数据量 > 1TB
- 支持分布式部署（未来版本）

### NFR-004: 易用性
**描述**: 系统使用的便捷性
**指标**:
- 安装配置时间 < 10 分钟
- 用户手册完整性 > 90%
- 错误信息可理解性 > 95%
- 新用户上手时间 < 30 分钟

## 测试覆盖要求

### 代码覆盖
- 单元测试覆盖率 > 80%
- 集成测试覆盖率 > 60%
- 端到端测试覆盖所有核心功能

### 场景覆盖
- 正常流程测试
- 异常情况测试
- 边界条件测试
- 性能极限测试
- 安全性测试

## 测试数据管理

### 测试数据分类
- **小型测试数据**: 1-100 个小文件，总大小 < 100MB
- **中型测试数据**: 100-1000 个文件，总大小 1GB
- **大型测试数据**: 1000-10000 个文件，总大小 10GB
- **超大型测试数据**: >10000 个文件，总大小 > 10GB

### 测试数据清理
- 每次测试前清理测试环境
- 测试后清理临时文件
- 保持测试数据的一致性
- 支持测试数据的快速重置

## 测试报告要求

### 报告内容
- 测试执行摘要
- 功能测试结果
- 性能测试结果
- 错误和异常统计
- 改进建议

### 报告格式
- HTML 格式的详细报告
- 控制台输出的简洁报告
- JSON 格式的机器可读报告
- 支持持续集成工具集成

## 风险评估

### 技术风险
- **数据丢失风险**: 低（有冗余备份）
- **性能不达标风险**: 中（需要优化）
- **兼容性风险**: 低（基于 Rust）

### 业务风险
- **用户接受度风险**: 中（需要良好界面）
- **维护成本风险**: 低（代码结构清晰）
- **扩展性风险**: 低（架构设计合理）

## 约束条件

### 技术约束
- 使用 Rust 语言开发
- 基于 Yew 框架的前端
- 使用 Reed-Solomon 编码算法
- 支持 Linux/macOS/Windows 平台

### 业务约束
- 必须保证数据完整性
- 系统资源占用合理
- 部署和维护简单
- 用户界面友好直观

### 时间约束
- 功能测试周期：2 周
- 性能测试周期：1 周
- 稳定性测试周期：1 周
- 总测试周期：4 周

## 验收标准

### 功能验收
- 所有核心功能正常工作
- 无严重和主要缺陷
- 用户手册完整准确
- 安装部署文档清晰

### 性能验收
- 满足所有性能指标
- 系统稳定性测试通过
- 负载测试表现良好
- 资源使用在预期范围内

### 质量验收
- 代码质量达标
- 测试覆盖率达标
- 文档完整性达标
- 用户体验良好